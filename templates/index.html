<!DOCTYPE html>
<html lang="en">

<head>
    <!-- ANTI-FOUC: Apply theme immediately before any CSS loads -->
    <script>
        (function () {
            var theme = localStorage.getItem('theme') || 'dark';
            if (theme === 'auto') {
                theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-theme');
            }
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Onyx - Private AI Assistant</title>
    <!-- Choices.js for styled dropdowns -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}?v=49">
    <script src="/static/js/main.js?v=49"></script>

    <!-- Marked.js for Markdown Rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js for Code Highlighting -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        // Markdown Configuration
        // Run immediately to ensure config is ready before initial render
        if (typeof marked !== 'undefined') {
            // Configure options
            marked.use({
                breaks: true
            });

            // Custom Renderer for Copy Buttons and Highlighting
            const renderer = new marked.Renderer();
            renderer.code = function (code, language) {
                // Handle new marked version where first arg is object {text, lang, ...}
                if (typeof code === 'object' && code !== null && code.text) {
                    language = code.lang || language;
                    code = code.text;
                }

                const lang = language || 'plaintext';
                const validLang = hljs.getLanguage(lang) ? lang : 'plaintext';
                let highlighted;
                try {
                    highlighted = hljs.highlight(code, { language: validLang }).value;
                } catch (e) {
                    highlighted = code; // Fallback
                }

                return `
                    <div class="code-block-wrapper">
                        <div class="code-header">
                            <span>${(lang || 'TEXT').toUpperCase()}</span>
                            <button class="copy-btn" onclick="copyCode(this)">ðŸ“‹ Copy</button>
                        </div>
                        <pre><code class="hljs language-${validLang}">${highlighted}</code></pre>
                        <div class="raw-code" style="display:none;">${encodeURIComponent(code)}</div>
                    </div>
                `;
            };
            marked.use({ renderer });
        }

        function copyCode(btn) {
            const wrapper = btn.closest('.code-block-wrapper');
            const rawCodeDiv = wrapper.querySelector('.raw-code');
            try {
                const code = decodeURIComponent(rawCodeDiv.innerText);
                navigator.clipboard.writeText(code).then(() => {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = 'âœ… Copied!';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                    }, 2000);
                });
            } catch (err) {
                console.error('Failed to copy', err);
                const code = decodeURIComponent(rawCodeDiv.textContent); // Fallback
                navigator.clipboard.writeText(code);
            }
        }
    </script>

    <style>
        :root {
            /* Light Theme (Default) */
            --bg-color: #ffffff;
            --sidebar-bg: #f8f9fa;
            --header-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #212529;
            --text-secondary: #6c757d;
            --accent-color: #007bff;
            --accent-hover: #0056b3;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --border-color: #dee2e6;

            /* UI Elements */
            --input-bg: #f1f3f5;
            --item-bg: #ffffff;
            --item-hover: #e9ecef;
        }

        /* Dark Theme Override */
        html.dark-theme,
        body.dark-theme {
            --bg-color: #0f172a;
            --sidebar-bg: rgba(15, 23, 42, 0.9);
            --header-bg: rgba(15, 23, 42, 0.95);
            --card-bg: rgba(30, 41, 59, 0.8);
            --text-color: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);

            /* UI Elements */
            --input-bg: #1e293b;
            --item-bg: rgba(30, 41, 59, 0.8);
            --item-hover: rgba(51, 65, 85, 0.8);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }


        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Header */
        header {
            background-color: var(--header-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            height: 60px;
        }

        .logo {
            font-size: 1.3em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--success-color);
        }

        .status-dot.offline {
            background-color: var(--error-color);
        }

        .status-dot.loading {
            background-color: var(--warning-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .top-actions {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background-color: #3d3d3d;
            color: white;
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: #505050;
        }

        .nav-btn.active {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        /* Main Layout */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative !important;
            /* Override main.css fixed positioning */
            top: auto !important;
            height: auto !important;
            /* Let flex handle height */
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 15px;
        }

        .sidebar h3 {
            margin: 0 0 10px 0;
            font-size: 0.85em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 10px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            margin-bottom: 15px;
            transition: background 0.2s;
        }

        .new-chat-btn:hover {
            background-color: var(--accent-hover);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px;
            background-color: var(--item-bg);
            border: 1px solid var(--border-color);
            /* Added border for visibility on light mode */
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 0.9em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
            color: var(--text-color);
        }

        .history-item:hover {
            background-color: var(--item-hover);
        }

        .history-item.active {
            background-color: var(--accent-color);
        }

        /* Unified Action Button Styles */
        .action-btn,
        .delete-session-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            margin-left: 2px;
            /* Force hidden state */
            opacity: 0 !important;
            visibility: hidden;
            transition: opacity 0.1s ease-in-out, visibility 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .history-item:hover .action-btn,
        .history-item:hover .delete-session-btn {
            /* Force visible state */
            opacity: 1 !important;
            visibility: visible;
        }

        /* High Contrast on Hover */
        .history-item:hover .action-btn svg,
        .history-item:hover .delete-session-btn svg {
            stroke: #ffffff !important;
            /* Force white stroke */
        }

        /* Keep Delete Red */
        .history-item:hover .delete-session-btn svg {
            stroke: #e74c3c !important;
            fill: #e74c3c !important;
        }

        /* Exceptions for filled icons (like active pin) */
        .action-btn svg[fill="#f1c40f"] {
            stroke: #f1c40f !important;
            fill: #f1c40f !important;
        }

        /* Indexed Files Section */
        .indexed-files {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .file-list {
            /* max-height removed to allow full page scroll */
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            width: 100%;
        }

        .file-card {
            position: relative;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .file-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            background: var(--item-hover);
        }

        .file-card .file-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .file-card .file-info {
            width: 100%;
        }

        .file-card .file-name {
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: 5px;
        }

        .file-card .file-meta {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .delete-btn-overlay {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            line-height: 18px;
            text-align: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .file-card:hover .delete-btn-overlay {
            opacity: 1;
        }

        .file-list {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .file-item {
            padding: 6px 10px;
            background-color: var(--item-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        /* .file-item::before removed to prevent double icon */

        /* FORCE FULL WIDTH */
        .file-manager,
        .drop-zone,
        .control-card,
        .indexed-files-section,
        #files-view {
            width: 100% !important;
            max-width: none !important;
            box-sizing: border-box !important;
        }

        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 80px;
            /* Doubled height */
            min-height: 300px;
            /* Explicit minimum height */
            text-align: center;
            background-color: rgba(255, 255, 255, 0.03);
            transition: all 0.2s;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .drop-zone .drop-help {
            margin-top: 15px;
            color: var(--text-secondary);
            font-size: 0.85em;
            opacity: 0.7;
        }

        /* Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background-color: var(--bg-color);
        }

        /* Views */
        .view-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: stretch;
            width: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        /* Control Panel Card */
        .control-card {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 100%;
            /* Full Width */
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            box-sizing: border-box;
        }

        /* Responsive: Stack on mobile/tablet */
        @media (max-width: 900px) {
            .control-card {
                grid-template-columns: 1fr;
            }
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            grid-column: 1 / -1;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-header h2 {
            margin: 0 !important;
            padding-bottom: 0 !important;
            border-bottom: none !important;
            flex-shrink: 0;
            /* Prevent wrapping */
        }

        .settings-header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .settings-header-actions button {
            margin: 0 !important;
            width: auto !important;
            /* Override primary-btn width 100% */
        }

        /* Settings Sections */
        .settings-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 0;
            /* Remove bottom margin in grid */
            height: 100%;
            /* Match grid height */
        }

        .settings-section:last-child {
            border-bottom: 1px solid var(--border-color);
            /* Restore border */
        }

        .settings-section h3 {
            margin: 0 0 15px 0;
            font-size: 1em;
            color: var(--text-color);
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
        }

        .setting-label span {
            font-size: 0.95em;
        }

        .setting-label small {
            color: var(--text-secondary);
            font-size: 0.8em;
            margin-top: 2px;
        }

        /* Form Elements */
        select,
        input[type="number"],
        input[type="text"] {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 0.9em;
            min-width: 150px;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        input[type="file"] {
            padding: 10px;
            border-radius: 6px;
            border: 2px dashed var(--border-color);
            background-color: #333;
            color: white;
            width: 100%;
            cursor: pointer;
        }

        input[type="file"]:hover {
            border-color: var(--accent-color);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked+.toggle-slider {
            background-color: var(--accent-color);
        }

        .toggle-switch input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }

        /* Mode Toggle in Header */
        .mode-toggle-container {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            border: 1px solid var(--border-color);
        }

        .mode-toggle-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .mode-toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .mode-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .mode-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #28a745;
            transition: 0.3s;
            border-radius: 26px;
        }

        .mode-toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .mode-toggle-switch input:checked+.mode-toggle-slider {
            background-color: #007bff;
        }

        .mode-toggle-switch input:checked+.mode-toggle-slider:before {
            transform: translateX(24px);
        }

        button.primary-btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 6px;
            border: none;
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.95em;
            transition: background 0.2s;
        }

        button.primary-btn:hover {
            background-color: var(--accent-hover);
        }

        button.danger-btn {
            background-color: var(--error-color);
        }

        button.danger-btn:hover {
            background-color: #c82333;
        }

        .secondary-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .secondary-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-color: var(--text-secondary);
            color: var(--text-color);
        }

        .secondary-btn.danger-btn {
            color: var(--error-color);
            border-color: var(--error-color);
        }

        .secondary-btn.danger-btn:hover {
            background-color: rgba(220, 53, 69, 0.1);
        }


        .btn-row {
            display: flex;
            gap: 10px;
        }

        .btn-row button {
            flex: 1;
        }

        /* Chat View */
        #chat-view {
            justify-content: flex-start;
            align-items: stretch;
            padding-bottom: 90px;
        }

        /* Critical: Ensure chat-view respects .hidden class */
        #chat-view.hidden {
            display: none !important;
        }

        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 850px;
            margin: 0 auto;
            width: 100%;
        }

        .chat-message {
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            line-height: 1.6;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .user-message {
            align-self: flex-end;
            background-color: transparent;
            color: var(--text-color);
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: #3d3d3d;
            color: #ddd;
            border-bottom-left-radius: 4px;
        }

        /* Markdown & Code Styles */
        .bot-message pre {
            background: #282c34 !important;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            position: relative;
            margin: 10px 0;
            border: 1px solid #444;
        }

        .bot-message code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }

        .bot-message p {
            margin: 0 0 10px 0;
        }

        .bot-message p:last-child {
            margin-bottom: 0;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #21252b;
            padding: 4px 12px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            font-size: 0.8em;
            color: #abb2bf;
            margin-bottom: -10px;
            /* Overlap param for pre */
            border: 1px solid #444;
            border-bottom: none;
        }

        .copy-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Input Bar */
        .input-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--header-bg);
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
        }

        .input-container {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 850px;
            align-items: center;
        }

        #chat-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 25px;
            border: 1px solid #444;
            background-color: #3d3d3d;
            color: white;
            outline: none;
            font-size: 0.95em;
        }

        #chat-input:focus {
            border-color: var(--accent-color);
        }

        .icon-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1.3em;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Status Messages */
        .status-msg {
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .notification {
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .notification.success {
            background-color: rgba(40, 167, 69, 0.2);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        .notification.error {
            background-color: rgba(220, 53, 69, 0.2);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }

        /* Health Status Panel */
        .health-panel {
            background-color: #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .health-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .health-item:last-child {
            border-bottom: none;
        }

        .health-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .health-status.healthy {
            color: var(--success-color);
        }

        .health-status.unhealthy {
            color: var(--error-color);
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ============== FILE MANAGER STYLES ============== */
        .file-manager {
            width: 100%;
            max-width: 900px;
        }

        .file-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .file-manager-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            background-color: #333;
            border-radius: 6px;
            overflow: hidden;
        }

        .view-toggle button {
            background: none;
            border: none;
            color: #888;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-toggle button.active {
            background-color: var(--accent-color);
            color: white;
        }

        .view-toggle button:hover:not(.active) {
            background-color: #444;
        }

        /* Drop Zone */
        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            margin-bottom: 20px;
            background-color: #2a2a2a;
        }

        .drop-zone.drag-over {
            border-color: var(--accent-color);
            background-color: rgba(0, 123, 255, 0.1);
        }

        .drop-zone-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .drop-zone-text {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .drop-zone input[type="file"] {
            display: none;
        }

        .browse-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background 0.2s;
        }

        .browse-btn:hover {
            background-color: var(--accent-hover);
        }

        /* File Grid */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .file-card {
            background-color: #333;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 2px solid transparent;
        }

        .file-card:hover {
            background-color: #3d3d3d;
            transform: translateY(-2px);
        }

        .file-card.selected {
            border-color: var(--accent-color);
            background-color: rgba(0, 123, 255, 0.15);
        }

        .file-card-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .file-card-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .file-card-name {
            font-size: 0.85em;
            word-break: break-word;
            margin-bottom: 5px;
            max-height: 40px;
            overflow: hidden;
        }

        .file-card-meta {
            font-size: 0.75em;
            color: var(--text-secondary);
        }

        .file-card-status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: var(--success-color);
            color: white;
        }

        .file-card-status.not-indexed {
            background-color: #666;
        }

        /* File List View */
        .file-list-view {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-list-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background-color: #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .file-list-item:hover {
            background-color: #3d3d3d;
        }

        .file-list-item.selected {
            border-color: var(--accent-color);
            background-color: rgba(0, 123, 255, 0.15);
        }

        .file-list-icon {
            font-size: 1.8em;
            width: 40px;
            text-align: center;
        }

        .file-list-info {
            flex: 1;
            min-width: 0;
        }

        .file-list-name {
            font-size: 0.95em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-list-meta {
            font-size: 0.8em;
            color: var(--text-secondary);
            display: flex;
            gap: 15px;
        }

        .file-list-actions {
            display: flex;
            gap: 8px;
        }

        .file-action-btn {
            background-color: #444;
            border: none;
            color: #aaa;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .file-action-btn:hover {
            background-color: #555;
            color: white;
        }

        .file-action-btn.danger:hover {
            background-color: var(--error-color);
        }

        /* Bulk Actions Bar */
        .bulk-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: #333;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .bulk-actions.hidden {
            display: none;
        }

        .selected-count {
            color: var(--text-secondary);
        }

        .bulk-buttons {
            display: flex;
            gap: 10px;
        }

        /* File Preview Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
        }

        .modal-close:hover {
            color: white;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .preview-content {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Staged Files */
        .staged-files-section {
            margin-bottom: 30px;
            background-color: #252526;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .staged-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .staged-header h3 {
            margin: 0;
            color: var(--accent-color);
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background-color: #2d2d2d;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            min-width: 150px;
            padding: 5px 0;
            display: none;
        }

        .context-menu.visible {
            display: block;
        }

        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            color: var(--text-color);
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .context-menu-item.danger:hover {
            background-color: var(--error-color);
        }

        /* Light Theme */
        body.light-theme {
            --bg-color: #f0f2f5;
            --sidebar-bg: #ffffff;
            --header-bg: #ffffff;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
        }

        body.light-theme .stat-card,
        body.light-theme .file-card,
        body.light-theme .control-card,
        body.light-theme .chat-message.bot-message,
        body.light-theme .history-item {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        body.light-theme .nav-btn {
            background-color: #f0f0f0;
            color: #333;
            border-color: #d0d0d0;
        }

        body.light-theme .nav-btn:hover {
            background-color: #e0e0e0;
        }

        body.light-theme .nav-btn.active {
            background-color: var(--accent-color);
            color: white;
        }

        body.light-theme .input-container {
            background-color: #ffffff;
            border: 1px solid #d0d0d0;
        }

        body.light-theme #chat-input {
            color: #333;
        }


        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #333 25%, #444 50%, #333 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            color: transparent !important;
            border-radius: 4px;
            min-height: 1em;
            display: inline-block;
            width: 100%;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        body.light-theme .skeleton {
            background: linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%);
        }


        /* Toast Notifications */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 250px;
            animation: slideIn 0.3s ease-out forwards;
            border-left: 4px solid var(--accent-color);
        }

        .toast.error {
            border-left-color: var(--error-color);
        }

        .toast.success {
            border-left-color: var(--success-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* Log Console */
        #log-console {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background-color: #1e1e1e;
            border-top: 1px solid var(--border-color);
            z-index: 9999;
            display: none;
            flex-direction: column;
            font-family: 'Consolas', monospace;
            font-size: 0.85em;
        }

        #log-console.visible {
            display: flex;
        }

        .log-header {
            padding: 5px 10px;
            background-color: #2d2d2d;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-body {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            color: #ccc;
        }

        .log-entry {
            margin-bottom: 4px;
            border-bottom: 1px solid #333;
            padding-bottom: 2px;
        }

        .log-time {
            color: #888;
            margin-right: 8px;
        }

        .log-level {
            font-weight: bold;
            margin-right: 8px;
        }

        .log-level.INFO {
            color: #007bff;
        }

        .log-level.ERROR {
            color: #dc3545;
        }

        .log-level.WARN {
            color: #ffc107;
        }

        /* Toast Notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease-out;
            min-width: 250px;
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.warning {
            background: #ffc107;
            color: #333;
        }

        .toast.info {
            background: #17a2b8;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Confirm Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }

        .modal-content {
            background: #2d2d2d;
            padding: 24px;
            border-radius: 12px;
            min-width: 320px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .modal-content p {
            font-size: 16px;
            margin-bottom: 20px;
            color: #eee;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .modal-btn.cancel {
            background: #555;
            color: white;
        }

        .modal-btn.cancel:hover {
            background: #666;
        }

        .modal-btn.confirm {
            background: #dc3545;
            color: white;
        }

        .modal-btn.confirm:hover {
            background: #c82333;
        }

        /* Delete Session Button */
        .delete-session-btn {
            background: transparent;
            border: none;
            padding: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: opacity 0.2s, transform 0.2s;
        }

        .delete-session-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .delete-session-btn svg {
            display: block;
        }

        /* Resizable Sidebar */
        .sidebar {
            position: relative;
            min-width: 180px;
            max-width: 400px;
            transition: none;
            /* Disable transition during resize */
        }

        .sidebar-resize-handle {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background: transparent;
            cursor: ew-resize;
            z-index: 100;
            transition: background 0.2s;
        }

        .sidebar-resize-handle:hover,
        .sidebar-resize-handle.active {
            background: var(--primary-color, #4a90d9);
        }

        /* Choices.js Dark Theme Overrides & Alignment Fixes */
        .choices__inner,
        .choices__list,
        .choices__list--dropdown,
        .choices__list[aria-expanded] {
            background-color: var(--bg-secondary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-color) !important;
        }

        /* Perfect Alignment for Chat Input Bar */
        #input-bar {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
            padding: 10px 0;
            margin-top: auto;
        }

        #input-bar.hidden {
            display: none !important;
        }

        /* Match Input Pill Shape - Only for model selector */
        .model-choices .choices__inner {
            border-radius: 20px !important;
            border: 1px solid var(--border-color) !important;
            background: var(--bg-secondary) !important;
            height: 100%;
            min-height: 44px;
            /* Matches input container height */
        }

        /* Remove default margin that might cause steps */
        .choices {
            margin-bottom: 0 !important;
            margin-right: 12px !important;
        }

        /* Continuation of previous styles (redundant but safe) */
        .choices[data-type*="select-one"] .choices__inner {
            padding-bottom: 0px;
            min-height: 40px;
            display: flex;
            align-items: center;
        }

        .choices__item,
        .choices__item--choice {
            color: var(--text-color) !important;
        }

        .choices__item--choice.is-highlighted {
            background-color: var(--accent-color) !important;
            color: white !important;
        }

        .choices__list--dropdown .choices__item--selectable.is-highlighted {
            background-color: var(--accent-color) !important;
        }

        .choices[data-type*="select-one"] .choices__inner {
            padding-bottom: 0px;
            min-height: 40px;
            display: flex;
            align-items: center;
        }

        .choices__item,
        .choices__item--choice {
            color: var(--text-color) !important;
        }

        .choices__item--choice.is-highlighted {
            background-color: var(--accent-color) !important;
            color: white !important;
        }

        .choices__list--dropdown .choices__item--selectable.is-highlighted {
            background-color: var(--accent-color) !important;
        }
    </style>
</head>

<body>
    <!-- Toast Container for notifications -->
    <div id="toast-container"></div>

    <!-- Server Down Overlay -->
    <div id="server-down-overlay" style="
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 99999;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    ">
        <div style="text-align: center; color: white;">
            <div style="font-size: 80px; margin-bottom: 20px;">ðŸ”Œ</div>
            <h1 style="margin: 0 0 10px 0; font-size: 2em;">Server is Closed</h1>
            <p style="color: #aaa; font-size: 1.1em; margin: 0 0 30px 0;">Start the server to access this page.</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button onclick="location.reload()" style="
                    background: var(--accent-color, #007bff);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 8px;
                    font-size: 1em;
                    cursor: pointer;
                ">ðŸ”„ Retry Connection</button>
            </div>
            <p style="color: #666; font-size: 0.85em; margin-top: 25px;">
                Run <code style="background: #333; padding: 3px 8px; border-radius: 4px;">python start_app.py</code> to
                start the server
            </p>
        </div>
    </div>
    <!-- Legacy prompt-modal removed -->

    <!-- Search Results Modal -->
    <div id="search-modal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: start; justify-content: center; padding-top: 80px;">
        <div class="modal-content"
            style="background: var(--bg-secondary); width: 700px; max-width: 90%; max-height: 80vh; border-radius: 12px; border: 1px solid var(--border-color); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
            <div class="modal-header"
                style="padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">ðŸ” Search Results</h3>
                <button onclick="document.getElementById('search-modal').style.display='none'"
                    style="background:none; border:none; color:var(--text-color); font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div id="search-results-body" class="modal-body" style="padding: 0; overflow-y: auto;">
                <!-- Results injected here -->
                <div style="padding: 20px; text-align: center; color: var(--text-muted);">Enter a query to search...
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts (main.js loaded in head) -->
    <!-- initApp is now called from main.js via DOMContentLoaded -->


    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p id="confirm-modal-message">Are you sure?</p>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="hideConfirmModal()">Cancel</button>
                <button class="modal-btn confirm" id="confirm-modal-ok">Delete</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"
        style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px;">
    </div>

    <!-- Rename Session Modal -->
    <div id="rename-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Rename Chat</h3>
            <input type="text" id="rename-input" placeholder="New Session Name"
                style="width: 100%; padding: 10px; margin-bottom: 20px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-color);">
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeRenameModal()">Cancel</button>
                <button class="modal-btn confirm" id="rename-confirm-btn"
                    style="background: var(--accent-color);">Save</button>
            </div>
        </div>
    </div>

    <!-- Prompt Library Modal -->
    <div id="prompt-library-modal" class="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
        <div class="modal-content"
            style="max-width: 600px; width:90%; background:var(--bg-primary, #1a1a1f); border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.5); padding:20px; position:relative;">
            <div class="modal-header"
                style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border-color); padding-bottom:15px; margin-bottom:20px;">
                <h3 style="margin:0; font-size:1.3em; color:var(--text-color);">ðŸ“š Prompt Library</h3>
                <span class="close-modal" onclick="closePromptLibrary()"
                    style="font-size:1.8em; cursor:pointer; color:var(--text-muted); line-height:1;">&times;</span>
            </div>
            <div class="modal-body">
                <!-- List View -->
                <div id="prompt-list-view">
                    <!-- Current System Prompt Area -->
                    <div
                        style="background:var(--bg-secondary); padding:15px; border-radius:8px; border:1px solid var(--border-color); margin-bottom:20px;">
                        <label
                            style="display:block; color:var(--text-color); margin-bottom:8px; font-weight:600; font-size:0.95em;">Active
                            System Prompt</label>
                        <textarea id="system-prompt" placeholder="You are a helpful AI assistant..." rows="3"
                            style="width:100%; box-sizing:border-box; border:1px solid var(--border-color); background:rgba(0,0,0,0.2); color:var(--text-color); padding:10px; border-radius:6px; resize:vertical; font-size:0.95em;"></textarea>
                    </div>

                    <!-- Search and New Prompt Row -->
                    <div style="display:flex; gap:10px; margin-bottom:15px; align-items:center;">
                        <input type="text" id="prompt-search" placeholder="Search prompts..." oninput="filterPrompts()"
                            style="flex:1; padding:10px 12px; border:1px solid var(--border-color); border-radius:6px; background:var(--bg-secondary); color:var(--text-color); font-size:0.95em;">
                        <button class="primary-btn" onclick="showCreatePromptForm()"
                            style="white-space:nowrap; padding:10px 16px;">+ New Prompt</button>
                    </div>

                    <!-- Saved Prompts List -->
                    <label
                        style="display:block; color:var(--text-muted); margin-bottom:10px; font-size:0.85em; text-transform:uppercase; letter-spacing:0.5px;">Saved
                        Prompts</label>
                    <div id="prompts-container"
                        style="max-height:300px; overflow-y:auto; border:1px solid var(--border-color); border-radius:8px; background:var(--bg-secondary);">
                        <!-- Prompts loaded here -->
                    </div>
                </div>

                <!-- Create/Edit Form (Hidden by default) -->
                <div id="prompt-form-view" style="display:none;">
                    <input type="text" id="prompt-title-input" placeholder="Prompt Title (e.g., Pirate Mode)"
                        style="width:100%; margin-bottom:10px; padding:8px; border-radius:4px; border:1px solid var(--border-color); background:var(--bg-secondary); color:var(--text-color);">
                    <textarea id="prompt-content-input" placeholder="Enter system prompt content..." rows="10"
                        style="width:100%; margin-bottom:10px; padding:8px; border-radius:4px; border:1px solid var(--border-color); background:var(--bg-secondary); color:var(--text-color); resize:vertical;"></textarea>
                    <div style="display:flex; justify-content:flex-end; gap:10px;">
                        <button class="secondary-btn" onclick="showPromptList()">Cancel</button>
                        <button class="primary-btn" onclick="savePrompt()">Save Prompt</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <header style="display: grid; grid-template-columns: auto 1fr auto; gap: 20px; align-items: center;">
        <!-- Logo + Brand Name -->
        <div style="display: flex; align-items: center; gap: 12px;">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Onyx"
                style="height: 40px; vertical-align: middle;">
            <span
                style="font-size: 1.5em; font-weight: 700; background: linear-gradient(135deg, #00d4ff 0%, #b968ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: 1px; font-family: 'Segoe UI', Arial, sans-serif;">ONYX</span>
        </div>

        <!-- Status + Search bar (centered with responsive width) -->
        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
            <div class="status-indicator" id="health-indicator" style="white-space: nowrap;">
                <span class="status-dot loading" id="status-dot"></span>
                <span id="status-text">Checking...</span>
            </div>
            <div style="position: relative; flex: 1; max-width: 500px; min-width: 200px;">
                <input type="text" id="global-search-input" placeholder="Search everything..."
                    onkeydown="handleGlobalSearch(event)"
                    style="width: 100%; padding: 8px 35px 8px 20px; border-radius: 20px; border: 1px solid var(--border-color); background: rgba(0,0,0,0.05); color: var(--text-color); transition: all 0.3s; font-size: 0.9em; text-align: center;">
                <span
                    style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); opacity: 0.5; font-size: 0.9em; pointer-events: none;">ðŸ”</span>
            </div>
        </div>

        <!-- Navigation buttons -->
        <div class="top-actions">
            <!-- Mode Toggle Removed (Moved to Controls) -->
            <button id="nav-btn-dashboard" class="nav-btn" onclick="showView('dashboard')">ðŸ“Š Dashboard</button>
            <button id="nav-btn-controls" class="nav-btn" onclick="showView('controls')">ðŸ“‚ Controls</button>
            <button id="nav-btn-files" class="nav-btn" onclick="showView('files')">ðŸ“ Files</button>


            <button id="nav-btn-settings" class="nav-btn" onclick="showView('settings')">âš™ï¸ Settings</button>
            <!-- Moved Theme Toggle to Settings View Bottom -->
        </div>
    </header>

    <div class="workspace">
        <aside class="sidebar">
            <div class="sidebar-header-actions" style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button class="new-chat-btn" onclick="newChat()" style="flex: 1; margin: 0;">âž• New Chat</button>
                <button id="bulk-delete-toggle-btn" class="secondary-btn" onclick="handleBulkDeleteClick(event)"
                    style="flex: 0 0 auto; padding: 0 12px; white-space: nowrap;">Clear chats</button>
            </div>

            <div id="bulk-select-container"
                style="display: none; padding: 0 10px 10px 10px; border-bottom: 1px solid var(--border-color); margin-bottom: 10px;">
                <label
                    style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--text-color); font-size: 0.9em; user-select: none;">
                    <input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this.checked)"
                        style="width: 16px; height: 16px; cursor: pointer;">
                    Select All
                </label>
            </div>

            <h3>Chat History</h3>
            <div class="history-list" id="session-list">
                {% for session in sessions %}
                <div class="history-item {% if session.id == current_session_id %}active{% endif %}"
                    onclick="switchSession({{ session.id }})" data-id="{{ session.id }}">
                    <span class="session-name" title="{{ session.name }}">{{ session.name }}</span>
                    <div class="session-actions" style="display: flex; gap: 0px;">
                        <!-- Pin Button -->
                        {% set is_pinned = session.is_pinned if session.is_pinned is defined else 0 %}
                        {% set pin_color = '#f1c40f' if is_pinned else 'var(--text-muted)' %}
                        <button class="action-btn"
                            onclick="event.stopPropagation(); toggleSessionPin({{ session.id }}, {{ is_pinned }}, event)"
                            title="{{ 'Unpin Session' if is_pinned else 'Pin Session' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="{{ pin_color if is_pinned else 'none' }}" stroke="{{ pin_color }}"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="17" x2="12" y2="22"></line>
                                <path
                                    d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17z">
                                </path>
                            </svg>
                        </button>

                        <!-- Rename Button -->
                        <button class="action-btn"
                            onclick="event.stopPropagation(); openRenameModal({{ session.id }}, '{{ session.name|replace("'", "\\'") }}', event)"
                            title="Rename Chat">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="var(--text-muted)" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>

                        <!-- Export Button -->
                        <button class="action-btn export-btn"
                            onclick="event.stopPropagation(); exportSession({{ session.id }}, event)"
                            title="Export Chat">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="var(--text-muted)" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </button>

                        <!-- Delete Button -->
                        <button class="delete-session-btn"
                            onclick="event.stopPropagation(); deleteSession({{ session.id }}, event)"
                            title="Delete Session">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="#e74c3c">
                                <path
                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z" />
                                <path d="M9 12h2v5H9zm4 0h2v5h-2z" fill="white" />
                            </svg>
                        </button>
                    </div>

                </div>
                {% else %}
                <div class="history-item active">Current Session</div>
                {% endfor %}
            </div>

            <!-- Resize Handle -->
            <div class="sidebar-resize-handle" id="sidebar-resize-handle"></div>

            <!-- Version Display -->
            <div class="version-display"
                style="position: absolute; bottom: 10px; left: 15px; font-size: 0.75em; color: var(--text-secondary, #888); opacity: 0.7;">
                Onyx v2.1.0
            </div>
        </aside>


        <main class="main-content">

            <!-- Dashboard View -->
            <div id="dashboard-view" class="view-section hidden"
                style="align-items: stretch; justify-content: flex-start; padding: 20px 30px; overflow-y: auto;">
                <div style="width: 100%; display: flex; flex-direction: column; flex: 1;">
                    <h2 style="margin-bottom: 20px;">ðŸ“Š Analytics Dashboard</h2>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="stat-docs">-</div>
                            <div class="stat-label">Documents</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-chunks">-</div>
                            <div class="stat-label">Chunks</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-sessions">-</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-messages">-</div>
                            <div class="stat-label">Messages</div>
                        </div>
                    </div>

                    <!-- ==============================================
                         IRON MAN DASHBOARD: COMMAND CENTER
                         ============================================== -->

                    <!-- 1. Rapid Launchpad (Quick Actions) -->
                    <div class="launchpad-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <button class="launch-btn" onclick="newChat()"
                            style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; padding: 20px; border-radius: 12px; border: none; cursor: pointer; text-align: left; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">
                            <div style="font-size: 24px; margin-bottom: 10px;">âž•</div>
                            <div style="font-weight: 600; font-size: 1.1em;">New Chat</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Start fresh research</div>
                        </button>

                        <button class="launch-btn" onclick="showView('files')"
                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px; border-radius: 12px; border: none; cursor: pointer; text-align: left; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                            <div style="font-size: 24px; margin-bottom: 10px;">ðŸ“‚</div>
                            <div style="font-weight: 600; font-size: 1.1em;">Knowledge Base</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Upload & manage files</div>
                        </button>

                        <button class="launch-btn" onclick="openPromptLibrary()"
                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 20px; border-radius: 12px; border: none; cursor: pointer; text-align: left; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                            <div style="font-size: 24px; margin-bottom: 10px;">ðŸ“</div>
                            <div style="font-weight: 600; font-size: 1.1em;">Prompt Library</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Access saved templates</div>
                        </button>
                    </div>

                    <div class="dashboard-grid-layout"
                        style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; flex: 1;">

                        <!-- LEFT COLUMN -->
                        <div class="dashboard-left-col">


                            <!-- 2. Knowledge Visualizer (Graph) - REMOVED (Moved to dedicated view) -->

                            <!-- 3. Recent Activity Feed (Existing) -->
                            <div class="activity-feed-section">
                                <h3
                                    style="margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                                    ðŸ“° Recent Activity</h3>
                                <div class="activity-list" style="display: flex; flex-direction: column; gap: 10px;">
                                    {% if recent_activity %}
                                    {% for session in recent_activity %}
                                    <div class="activity-card"
                                        style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                                        <div class="activity-info">
                                            <div style="font-weight: 600; color: var(--text-color);">{{ session.name }}
                                            </div>
                                            <div style="font-size: 0.85em; color: var(--text-secondary);">Last updated:
                                                {{ session.updated_at }}</div>
                                        </div>
                                        <div class="activity-meta" style="text-align: right;">
                                            <button class="icon-btn" onclick="togglePin({{ session.id }}, true)"
                                                title="Pin Chat">ðŸ“Œ</button>
                                            <button class="icon-btn"
                                                onclick="switchSession({{ session.id }}); showView('chat');"
                                                title="Resume Chat" style="margin-left: 5px;">âž¡ï¸</button>
                                        </div>
                                    </div>
                                    {% endfor %}
                                    {% else %}
                                    <div class="empty-activity">No recent activity.</div>
                                    {% endif %}
                                </div>
                            </div>

                        </div>

                        <!-- RIGHT COLUMN -->
                        <div class="dashboard-right-col">

                            <!-- 4. Pinned Chats (Gallery) -->
                            <div class="pinned-section" style="margin-bottom: 20px;">
                                <h3 style="margin-bottom: 10px;">ðŸ“Œ Pinned Chats</h3>
                                <div id="pinned-chats-container"
                                    style="display: flex; flex-direction: column; gap: 10px;">
                                    {% if pinned_sessions %}
                                    {% for chat in pinned_sessions %}
                                    <div class="pinned-card" onclick="switchSession({{ chat.id }}); showView('chat');"
                                        style="background: var(--card-bg); padding: 12px; border-radius: 8px; border-left: 3px solid var(--accent-color); cursor: pointer; transition: transform 0.2s;">
                                        <div style="font-weight: 500;">{{ chat.name }}</div>
                                        <div style="font-size: 0.8em; color: var(--text-secondary);">{{ chat.model_used
                                            }}</div>
                                    </div>
                                    {% endfor %}
                                    {% else %}
                                    <div style="font-size: 0.9em; color: var(--text-muted); font-style: italic;">No
                                        pinned chats yet.</div>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel View -->
            <div id="control-panel" class="view-section" style="align-items: stretch; padding: 20px 30px;">

                <!-- 1. Unified Status Bar -->
                <div class="status-bar-strip"
                    style="display: flex; align-items: center; justify-content: space-between; padding: 15px 30px; margin-bottom: 20px; background: var(--bg-secondary); border-left: 4px solid var(--accent-color); border-radius: 8px; flex-wrap: wrap; gap: 15px;">
                    <div class="status-item">
                        <span class="label"
                            style="color: var(--text-muted); font-size: 0.9em; margin-right: 10px;">SYSTEM STATUS</span>
                        <span class="health-status" id="ollama-status" style="font-weight: 600;">Checking...</span>
                    </div>
                    <div class="status-divider" style="width: 1px; height: 20px; background: var(--border-color);">
                    </div>
                    <div class="status-item">
                        <span class="label" style="color: var(--text-muted); font-size: 0.85em; margin-right: 8px;">CHAT
                            MODEL</span>
                        <span class="badge" id="model-status"
                            style="background: rgba(0, 123, 255, 0.2); color: #4dabf7; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">{{
                            config.model }}</span>
                    </div>
                    <div class="status-divider" style="width: 1px; height: 20px; background: var(--border-color);">
                    </div>
                    <div class="status-item">
                        <span class="label"
                            style="color: var(--text-muted); font-size: 0.85em; margin-right: 8px;">IMAGE MODEL</span>
                        <span class="badge"
                            style="background: rgba(156, 39, 176, 0.2); color: #ce93d8; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">ðŸ–¼ï¸
                            moondream</span>
                    </div>
                    <div class="status-divider" style="width: 1px; height: 20px; background: var(--border-color);">
                    </div>
                    <div class="status-item">
                        <span class="label" style="color: var(--text-muted); font-size: 0.85em; margin-right: 8px;">DOC
                            MODEL</span>
                        <span class="badge"
                            style="background: rgba(76, 175, 80, 0.2); color: #81c784; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">ðŸ“„
                            nomic-embed-text</span>
                    </div>
                    <div class="status-divider" style="width: 1px; height: 20px; background: var(--border-color);">
                    </div>
                    <div class="status-item">
                        <span class="label"
                            style="color: var(--text-muted); font-size: 0.85em; margin-right: 8px;">KNOWLEDGE
                            BASE</span>
                        <span id="chunk-count" style="font-family: monospace; font-size: 1em;">-</span> <span
                            style="font-size: 0.8em; color: var(--text-muted);">chunks</span>
                    </div>
                    <div class="status-divider" style="width: 1px; height: 20px; background: var(--border-color);">
                    </div>
                    <div class="status-item">
                        <span class="label"
                            style="color: var(--text-muted); font-size: 0.85em; margin-right: 8px;">MODE</span>
                        <span id="current-mode-badge"
                            style="text-transform: uppercase; font-weight: bold; letter-spacing: 1px;">{{ config.mode
                            }}</span>
                    </div>
                </div>

                <!-- 2. Main Dashboard Grid -->
                <div class="dashboard-layout"
                    style="display: grid; grid-template-columns: 1fr 1.8fr; gap: 25px; flex: 1;">

                    <!-- Left Column: Command Center -->
                    <div class="control-card command-center"
                        style="display: flex; flex-direction: column; gap: 20px; height: 100%;">
                        <div class="card-header"
                            style="border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 5px;">
                            <h3>ðŸš€ Command Center</h3>
                        </div>

                        <!-- Mode Switcher -->
                        <div class="control-group">
                            <label
                                style="display: block; color: var(--text-muted); margin-bottom: 10px; font-size: 0.9em;">OPERATIONAL
                                MODE</label>
                            <div class="mode-toggles"
                                style="display: flex; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 5px;">
                                <button class="mode-btn {{ 'active' if config.mode == 'cli' else '' }}"
                                    data-mode="cli" onclick="setMode('cli')" id="cli-mode-btn"
                                    style="flex: 1; border: none; background: transparent; padding: 10px; color: var(--text-muted); cursor: pointer; border-radius: 6px; transition: all 0.2s;">
                                    ðŸ’» Terminal (CLI)
                                </button>
                                <button class="mode-btn {{ 'active' if config.mode == 'browser' else '' }}"
                                    data-mode="browser" onclick="setMode('browser')" id="browser-mode-btn"
                                    style="flex: 1; border: none; background: transparent; padding: 10px; color: var(--text-muted); cursor: pointer; border-radius: 6px; transition: all 0.2s;">
                                    ðŸŒ Browser Interface
                                </button>
                            </div>
                            <style>
                                .mode-btn.active {
                                    background: var(--accent-color) !important;
                                    color: white !important;
                                    font-weight: 600;
                                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                                }

                                .mode-btn:hover:not(.active) {
                                    background: rgba(255, 255, 255, 0.05) !important;
                                    color: white !important;
                                }
                            </style>
                        </div>

                        <!-- Quick Actions -->
                        <div class="control-group" style="flex: 1; display: flex; flex-direction: column;">
                            <label
                                style="display: block; color: var(--text-muted); margin-bottom: 10px; font-size: 0.9em;">QUICK
                                ACTIONS</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; flex: 1;">
                                <button onclick="showView('files')" class="action-tile"
                                    style="padding: 20px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); border-radius: 8px; color: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; transition: all 0.2s;">
                                    <span style="font-size: 32px;">ðŸ“‚</span>
                                    <span style="font-size: 1.1em; font-weight: 500;">Manage Files</span>
                                </button>
                                <button onclick="showView('settings')" class="action-tile"
                                    style="padding: 20px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); border-radius: 8px; color: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; transition: all 0.2s;">
                                    <span style="font-size: 32px;">âš™ï¸</span>
                                    <span style="font-size: 1.1em; font-weight: 500;">Settings</span>
                                </button>
                                <button onclick="window.open('/api/health', '_blank')" class="action-tile"
                                    style="padding: 20px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); border-radius: 8px; color: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; transition: all 0.2s;">
                                    <span style="font-size: 32px;">ðŸ¥</span>
                                    <span style="font-size: 1.1em; font-weight: 500;">System Health</span>
                                </button>
                                <!-- Placeholder for future action -->
                                <button disabled class="action-tile"
                                    style="padding: 20px; background: rgba(255,255,255,0.01); border: 1px dashed var(--border-color); border-radius: 8px; color: var(--text-muted); cursor: not-allowed; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px;">
                                    <span style="font-size: 32px; opacity: 0.3;">âž•</span>
                                    <span style="font-size: 1.1em; font-weight: 500;">Add Widget</span>
                                </button>
                            </div>
                        </div>


                        <!-- Ollama Service Control -->
                        <div class="control-group"
                            style="padding-top: 15px; border-top: 1px solid var(--border-color); margin-top: 10px;">
                            <label
                                style="display: block; color: var(--text-muted); margin-bottom: 10px; font-size: 0.9em;">OLLAMA
                                SERVICE</label>

                            <!-- Status Display -->
                            <div
                                style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); padding: 10px; border-radius: 6px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div id="ollama-ctrl-dot" class="status-dot offline"></div>
                                    <span id="ollama-ctrl-text"
                                        style="font-weight: 500; font-size: 0.9em;">Unknown</span>
                                </div>
                                <button onclick="checkHealth()"
                                    style="background:none; border:none; cursor:pointer; opacity: 0.7;"
                                    title="Refresh Status">ðŸ”„</button>
                            </div>

                            <!-- Actions -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button id="btn-ollama-start" onclick="controlOllama('start')"
                                    style="padding: 10px; background: #2f855a; color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.9em; transition: all 0.2s;">
                                    â–¶ Start
                                </button>
                                <button id="btn-ollama-restart" onclick="controlOllama('restart')"
                                    style="padding: 10px; background: #c05621; color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.9em; transition: all 0.2s;">
                                    âš¡ Restart
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Model Hub -->
                    <div class="control-card model-hub" style="display: flex; flex-direction: column;">
                        <div class="card-header"
                            style="border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <h3>ðŸ§  Neural Model Hub</h3>
                            <button onclick="fetchModelsForControls()"
                                style="background: transparent; border: none; color: var(--accent-color); cursor: pointer; font-size: 0.9em; display: flex; align-items: center; gap: 5px;">
                                ðŸ”„ Refresh
                            </button>
                        </div>

                        <!-- Pull New Model -->
                        <div
                            style="position: relative; margin-bottom: 20px; display: flex; align-items: center; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid var(--border-color);">
                            <input type="text" id="new-model-name"
                                placeholder="Enter model name (e.g. llama3, mistral, phi3)"
                                style="flex: 1; padding: 12px 16px; border: none; background: transparent; color: white; font-size: 1em; outline: none;">
                            <button id="pull-btn" onclick="pullNewModel()"
                                style="background: var(--accent-color); color: white; border: none; cursor: pointer; padding: 10px 48px; margin-right: 8px; border-radius: 6px; font-size: 0.9em; font-weight: 500;">Pull</button>
                        </div>

                        <pre id="pull-logs"
                            style="display: none; background: #000; color: #0f0; padding: 15px; border-radius: 6px; margin-bottom: 20px; max-height: 150px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 0.85em;"></pre>

                        <!-- Model Table -->
                        <div class="table-container" style="flex: 1; overflow-auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 2px solid var(--border-color);">
                                        <th style="text-align: left; padding: 12px; color: var(--text-muted);">MODEL
                                            NAME</th>
                                        <th style="padding: 12px; color: var(--text-muted);">SIZE</th>
                                        <th style="padding: 12px; color: var(--text-muted);">UPDATED</th>
                                        <th style="padding: 12px; color: var(--text-muted); text-align: right;">ACTION
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="model-list-body">
                                    <tr>
                                        <td colspan="4"
                                            style="padding: 30px; text-align: center; color: var(--text-muted);">
                                            Scanning local models...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Settings View -->
            <div id="settings-view" class="view-section hidden">
                <div class="control-card">
                    <div class="settings-header">
                        <h2>âš™ï¸ Settings</h2>
                        <div class="settings-header-actions">
                            <button class="primary-btn" id="save-settings-btn" onclick="saveAllSettings()"
                                style="padding: 6px 15px; font-size: 0.9em;">ðŸ’¾ Save All</button>
                            <button class="primary-btn danger-btn" id="reset-settings-btn" onclick="resetSettings()"
                                style="padding: 6px 15px; font-size: 0.9em;">ðŸ”„ Reset</button>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings-section">
                        <h3>ðŸ”” Notification Settings</h3>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Toast Notifications</span>
                                <small>Show popup notifications for actions</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="toast-notifications" checked
                                    onchange="updateSetting('toast_notifications', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Sound Effects</span>
                                <small>Play sounds for notifications</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sound-effects"
                                    onchange="updateSetting('sound_effects', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Desktop Notifications</span>
                                <small>Show browser desktop notifications</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="desktop-notifications"
                                    onchange="updateSetting('desktop_notifications', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Notification Duration</span>
                                <small>How long toast notifications display (seconds)</small>
                            </div>
                            <input type="number" id="notification-duration" value="3" min="1" max="10"
                                onchange="updateSetting('notification_duration', parseInt(this.value))">
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Error Notifications</span>
                                <small>Show notifications for errors</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="error-notifications" checked
                                    onchange="updateSetting('error_notifications', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- RAG Settings -->
                    <div class="settings-section">
                        <h3>ðŸ” Retrieval Settings</h3>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Chunk Size</span>
                                <small>Size of text chunks (tokens)</small>
                            </div>
                            <input type="number" id="chunk-size" value="{{ config.chunk_size }}" min="100" max="4000"
                                onchange="updateSetting('chunk_size', parseInt(this.value))">
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Chunk Overlap</span>
                                <small>Overlap between chunks</small>
                            </div>
                            <input type="number" id="chunk-overlap" value="{{ config.chunk_overlap }}" min="0"
                                max="1000" onchange="updateSetting('chunk_overlap', parseInt(this.value))">
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Documents to Retrieve (k)</span>
                                <small>Number of relevant chunks</small>
                            </div>
                            <input type="number" id="retrieval-k" value="{{ config.retrieval_k }}" min="1" max="20"
                                onchange="updateSetting('retrieval_k', parseInt(this.value))">
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Hybrid Search</span>
                                <small>Combine BM25 + vector search</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="hybrid-search" {% if config.use_hybrid_search %}checked{%
                                    endif %} onchange="updateSetting('use_hybrid_search', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row" id="hybrid-alpha-row">
                            <div class="setting-label">
                                <span>Hybrid Alpha</span>
                                <small>Vector weight (1-Î± for BM25)</small>
                            </div>
                            <input type="number" id="hybrid-alpha" value="{{ config.hybrid_alpha }}" min="0" max="1"
                                step="0.1" onchange="updateSetting('hybrid_alpha', parseFloat(this.value))">
                        </div>
                    </div>

                    <!-- Chat Settings -->
                    <div class="settings-section">
                        <h3>ðŸ’¬ Chat Settings</h3>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>History Context</span>
                                <small>Messages to include in context</small>
                            </div>
                            <input type="number" id="max-history" value="{{ config.max_history_context }}" min="0"
                                max="50" onchange="updateSetting('max_history_context', parseInt(this.value))">
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Show Sources</span>
                                <small>Display source documents in responses</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-sources" {% if config.show_sources %}checked{% endif %}
                                    onchange="updateSetting('show_sources', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Text-to-Speech</span>
                                <small>Read responses aloud</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="tts-toggle" {% if config.enable_tts %}checked{% endif %}
                                    onchange="updateSetting('enable_tts', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Theme & Nav Controls (Moved Here) -->
                    <div class="settings-section">
                        <h3>ðŸŽ¨ Appearance & Navigation</h3>
                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Theme Mode</span>
                                <small>Toggle light/dark mode</small>
                            </div>
                            <select id="theme-selector" onchange="setTheme(this.value)" class="form-select"
                                style="width: auto; padding: 6px 12px; background: var(--bg-secondary); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 6px;">
                                <option value="light">â˜€ï¸ Light</option>
                                <option value="dark">ðŸŒ™ Dark</option>
                                <option value="auto">ðŸŒ— Auto (System)</option>
                            </select>
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Accent Color</span>
                                <small>Customize primary brand color</small>
                            </div>
                            <div class="color-picker-row" style="display: flex; gap: 10px;">
                                <button class="color-dot active"
                                    style="background-color: #6366f1; border: 2px solid white; box-shadow: 0 0 0 2px #6366f1;"
                                    onclick="setAccentColor('#6366f1', this)" aria-label="Indigo"></button>
                                <button class="color-dot" style="background-color: #10b981;"
                                    onclick="setAccentColor('#10b981', this)" aria-label="Emerald"></button>
                                <button class="color-dot" style="background-color: #f59e0b;"
                                    onclick="setAccentColor('#f59e0b', this)" aria-label="Amber"></button>
                                <button class="color-dot" style="background-color: #ec4899;"
                                    onclick="setAccentColor('#ec4899', this)" aria-label="Pink"></button>
                                <button class="color-dot" style="background-color: #3b82f6;"
                                    onclick="setAccentColor('#3b82f6', this)" aria-label="Blue"></button>
                            </div>
                        </div>

                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Compact Mode</span>
                                <small>Reduce spacing for higher information density</small>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="compact-mode-toggle"
                                    onchange="toggleCompactMode(this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Files View -->

            <div id="files-view" class="view-section hidden">
                <div class="file-manager">
                    <div class="file-manager-header">
                        <h2 style="margin: 0;">ðŸ“ File Manager</h2>
                        <div class="file-manager-actions">
                            <div class="view-toggle">
                                <button id="grid-view-btn" class="active" onclick="setFileView('grid')"
                                    title="Grid View">â–¦</button>
                                <button id="list-view-btn" onclick="setFileView('list')" title="List View">â˜°</button>
                            </div>
                            <button class="primary-btn" onclick="loadFiles()"
                                style="width: auto; margin: 0; padding: 8px 15px;">
                                ðŸ”„ Refresh
                            </button>
                        </div>
                    </div>

                    <!-- 1. Drop Zone (Top) -->
                    <div class="drop-zone" id="drop-zone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)"
                        ondragleave="handleDragLeave(event)">
                        <div class="drop-zone-icon">ðŸ“¤</div>
                        <div class="drop-zone-text">Drag & drop files here to stage them</div>
                        <input type="file" id="file-input" multiple
                            accept=".pdf,.txt,.md,.docx,.csv,.xlsx,.xls,.pptx,.ppt,.jpg,.jpeg,.png,.xaml"
                            onchange="handleFileSelect(event)">
                        <button class="browse-btn" onclick="document.getElementById('file-input').click()">
                            Browse Files
                        </button>
                        <div class="drop-help">Supported: PDF, TXT, MD, DOCX, CSV, JPG, PNG</div>
                    </div>

                    <!-- 2. Staged Files Section -->
                    <div id="staged-files-section" class="staged-files-section hidden">
                        <div class="staged-header">
                            <h3>ðŸ“‹ Staged Files (Ready to Upload)</h3>
                            <button class="primary-btn" onclick="uploadStagedFiles()" style="width: auto; margin: 0;">
                                ðŸš€ Upload to RAG
                            </button>
                        </div>
                        <div id="staged-file-grid" class="file-grid">
                            <!-- Staged files render here -->
                        </div>
                    </div>

                    <!-- 3. Indexed Files Section -->
                    <div class="indexed-files-section">
                        <h3 style="margin-bottom: 15px; border-bottom: 1px solid #3e3e42; padding-bottom: 10px;">
                            ðŸ“š Indexed RAG Documents (Database)
                        </h3>

                        <!-- Bulk Actions -->
                        <div class="bulk-actions hidden" id="bulk-actions">
                            <span class="selected-count"><span id="selected-count">0</span> files selected</span>
                            <div class="bulk-buttons">
                                <button class="primary-btn danger-btn"
                                    style="width: auto; margin: 0; padding: 8px 15px;" onclick="deleteSelectedFiles()">
                                    ðŸ—‘ï¸ Delete Selected
                                </button>
                                <button class="file-action-btn" onclick="clearSelection()">
                                    âœ• Clear Selection
                                </button>
                            </div>
                        </div>

                        <!-- File Grid Container -->
                        <div id="file-container">
                            <div class="file-grid" id="file-grid">
                                <!-- Indexed files load here -->
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div class="empty-state hidden" id="empty-state">
                            <div class="empty-state-icon">ðŸ“‚</div>
                            <p>No documents indexed yet</p>
                        </div>

                        <!-- Index Management -->
                        <div class="index-management-section"
                            style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                            <h3 style="margin-bottom: 15px;">ðŸ§  Index Management</h3>

                            <!-- Index Stats Overview -->
                            <div class="index-stats-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div class="stat-card minimal">
                                    <div class="stat-label">Indexed Documents</div>
                                    <div class="stat-value" id="mgmt-stat-docs">-</div>
                                </div>
                                <div class="stat-card minimal">
                                    <div class="stat-label">Total Vectors (Chunks)</div>
                                    <div class="stat-value" id="mgmt-stat-chunks">-</div>
                                </div>
                                <div class="stat-card minimal">
                                    <div class="stat-label">Vector Database</div>
                                    <div class="stat-value">ChromaDB</div>
                                </div>
                            </div>

                            <div
                                style="background: rgba(255, 59, 48, 0.1); border: 1px solid rgba(255, 59, 48, 0.2); padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--danger-color); margin-top: 0; margin-bottom: 10px;">âš ï¸ Danger
                                    Zone</h4>
                                <p style="font-size: 0.9em; margin-bottom: 15px; color: var(--text-secondary);">
                                    Clearing the index will remove all "memory" of your documents. You will need to
                                    re-upload files to search them again. This is the AI's memory of your RAG documents.
                                    Clearing this will remove all AI's memory of your documents.
                                </p>
                                <button class="primary-btn danger-btn" onclick="clearIndex(this)"
                                    style="width: auto; transition: all 0.2s;">
                                    ðŸ—‘ï¸ Clear All Indexed Documents
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Context Menu -->
            <div id="context-menu" class="context-menu">
                <!-- Items injected dynamically -->
            </div>

            <!-- File Preview Modal -->
            <div class="modal-overlay hidden" id="preview-modal" onclick="closePreviewModal(event)">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3><span id="preview-icon">ðŸ“„</span> <span id="preview-filename">File Preview</span></h3>
                        <button class="modal-close" onclick="closePreviewModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="preview-content">Loading...</div>
                    </div>
                    <div class="modal-footer">
                        <button class="file-action-btn" onclick="closePreviewModal()">Close</button>
                        <button class="primary-btn" style="width: auto; margin: 0;" id="preview-ingest-btn"
                            onclick="ingestPreviewFile()">
                            ðŸ“¥ Ingest This File
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat View -->
            <div id="chat-view" class="view-section hidden">
                <div class="chat-messages" id="chat-history">
                    <!-- Messages will be injected here -->
                    {% for role, msg in chat_history %}
                    <div class="chat-message {{ 'user-message' if role == 'User' else 'bot-message' }}">{{ msg }}
                    </div>
                    {% endfor %}
                    <!-- Scroll Anchor: Always at bottom for scrollIntoView -->
                    <div id="chat-scroll-anchor" style="height: 1px;"></div>
                </div>

                <!-- Empty State (Welcome Message) -->
                <div id="chat-empty-state" class="empty-state-container"
                    style="display: none; height: 100%; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; color: var(--text-color);">
                    <div
                        style="background: var(--bg-secondary); padding: 30px; border-radius: 12px; border: 1px solid var(--border-color); max-width: 600px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
                        <div style="font-size: 48px; margin-bottom: 20px;">ðŸ‘‹</div>
                        <h2 style="margin-bottom: 15px;">Welcome to Onyx!</h2>
                        <p style="color: var(--text-secondary); line-height: 1.6; font-size: 1.1em;">
                            Your private AI assistant. Ask me questions about your documents or just chat with me.
                            <br>I keep everything local and secure.
                        </p>
                    </div>
                </div>

                <!-- Scroll to Bottom Button -->
                <button id="scroll-bottom-btn" onclick="scrollToBottom()" title="Scroll to Bottom">
                    â¬‡ï¸
                </button>

                <style>
                    #scroll-bottom-btn {
                        position: absolute;
                        bottom: 90px;
                        right: 30px;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        background: var(--accent-color);
                        color: white;
                        border: none;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.2em;
                        opacity: 0;
                        visibility: hidden;
                        transition: all 0.3s ease;
                        z-index: 100;
                    }

                    #scroll-bottom-btn.visible {
                        opacity: 1;
                        visibility: visible;
                        bottom: 100px;
                        /* Slight float up animation */
                    }

                    #scroll-bottom-btn:hover {
                        transform: scale(1.1);
                        background: var(--primary-color);
                    }
                </style>
            </div>


            <!-- Input Bar -->
            <div id="input-bar" class="input-bar hidden" style="flex-direction: column; align-items: stretch;">
                <div id="image-previews" class="image-previews"></div>
                <div id="doc-previews" class="doc-previews"
                    style="display: none; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;"></div>
                <!-- Input Container with nested Model Selector -->
                <div class="input-container"
                    style="flex: 1; display: flex; align-items: center; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 25px; padding: 3px 10px;">

                    <!-- Integrated Model Selector (Badge Style) -->
                    <div style="display: flex; align-items: center;">
                        <select id="model-select" onchange="handleModelChange(this.value)"
                            style="background: transparent; border: none; color: var(--accent-color); font-weight: bold; padding: 0px 8px 4px 8px; cursor: pointer; font-size: 0.85em; margin-right: 5px; outline: none; transform: translateY(-3px);">
                            {% for model in config.available_models %}
                            <option value="{{ model }}" {% if model==config.model %}selected{% endif %}>{{ model }}
                            </option>
                            {% endfor %}
                            <option value="__manage__">âš™ï¸ Manage Models...</option>
                        </select>
                    </div>

                    <!-- Divider -->
                    <div style="width: 1px; height: 16px; background: var(--border-color); margin-right: 8px;">
                    </div>

                    <!-- Voice Toggle (Speaker) -->
                    <button class="icon-btn" id="voice-toggle-btn" onclick="toggleVoice()"
                        title="Toggle Voice Response (Jarvis Mode)"
                        style="background: none; padding: 8px; margin-right: 2px;">
                        ðŸ”‡
                    </button>

                    <!-- Single Attachment Button (Images + Documents) -->
                    <button class="icon-btn" onclick="document.getElementById('file-upload').click()"
                        title="Attach files (images & documents, max 5)"
                        style="background: none; padding: 8px; margin-right: 5px;">
                        <span style="font-size: 18px;">ðŸ“Ž</span>
                    </button>
                    <input type="file" id="file-upload" style="display: none;"
                        accept="image/*,.txt,.pdf,.doc,.docx,.csv,.md,.json,.xml" onchange="uploadFiles()" multiple>

                    <input type="text" id="chat-input" placeholder="Ask a question..."
                        onkeypress="if(event.key==='Enter') sendMessage()"
                        style="flex: 1; background: transparent; border: none; outline: none; color: var(--text-color); font-size: 0.95em; padding: 8px 5px;">


                    <!-- Voice Waveform Visualization (hidden by default) -->
                    <div id="voice-waveform"
                        style="display: none; flex: 1; height: 30px; align-items: center; justify-content: center; gap: 3px;">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <span
                            style="color: var(--error-color); font-size: 0.8em; margin-left: 10px;">Recording...</span>
                    </div>


                    <!-- Deep Search Toggle -->
                    <button class="icon-btn" id="deep-search-btn" onclick="toggleDeepSearch()"
                        title="Deep Search (Query Expansion)"
                        style="background: none; padding: 8px; margin-right: 2px; opacity: 0.5;">
                        <img src="https://img.icons8.com/ios/20/ffffff/brain.png" alt="Deep Search"
                            style="width:20px;height:20px;">
                    </button>

                    <!-- Mic (Right inside textbox) -->
                    <button class="icon-btn" onclick="startVoice()" title="Voice Input"
                        style="background: none; padding: 8px;">
                        <img src="https://img.icons8.com/ios/20/ffffff/microphone--v1.png" alt="Mic"
                            style="width:20px;height:20px;">
                    </button>

                    <!-- Send (Beside mic) -->
                    <button class="icon-btn" onclick="sendMessage()" title="Send Message"
                        style="background: none; padding: 8px; margin-left: 5px;">
                        <img src="https://img.icons8.com/ios-filled/20/ffffff/sent.png" alt="Send"
                            style="width:20px;height:20px;">
                    </button>
                </div>
            </div>


        </main>
    </div>
    <script>
        window.APP_CONFIG = {
            mode: '{{ config.mode }}',
            currentSessionId: {{ current_session_id or 'null' }},
        model: '{{ config.model }}'
        };
    </script>
    <script src="/static/js/modules.js?v=51"></script>
    <style>
        .file-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .image-previews {
            display: none;
            padding: 8px;
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-bottom: 5px;
            width: 100%;
            box-sizing: border-box;
            flex-wrap: wrap;
        }

        .preview-thumb {
            width: 60px;
            height: 60px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .preview-remove {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 18px;
            height: 18px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            line-height: 1;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .file-list .file-card {
            display: flex;
            flex-direction: row;
            align-items: center;
            width: 100%;
            height: auto;
            padding: 10px;
        }

        .file-list .file-icon {
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            margin-bottom: 0;
            margin-right: 15px;
        }

        .file-list .file-info {
            flex: 1;
            text-align: left;
        }

        /* No file actions buttons */
        .file-actions {
            display: none !important;
        }

        /* Context Menu CSS */
        .context-menu {
            display: none;
            position: fixed;
            z-index: 9999;
            background-color: #252526;
            border: 1px solid #454545;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            min-width: 150px;
            border-radius: 4px;
            padding: 5px 0;
            color: #cccccc;
        }

        .context-menu.visible {
            display: block;
        }

        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .context-menu-item:hover {
            background-color: #37373d;
            color: #ffffff;
        }

        .context-menu-item.danger {
            color: #f14c4c;
        }

        .context-menu-item.danger:hover {
            background-color: rgba(241, 76, 76, 0.2);
            color: #ff6b6b;
        }

        /* Mode Buttons */
        .mode-buttons {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            background: transparent;
            color: var(--text-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-color);
        }

        .mode-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</body>

</html>